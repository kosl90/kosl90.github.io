<!doctype html>
<!--[if lt IE 7]><html class="no-js lt-ie9 lt-ie8 lt-ie7" lang="en"> <![endif]-->
<!--[if (IE 7)&!(IEMobile)]><html class="no-js lt-ie9 lt-ie8" lang="en"><![endif]-->
<!--[if (IE 8)&!(IEMobile)]><html class="no-js lt-ie9" lang="en"><![endif]-->
<!--[if gt IE 8]><!--> <html class="no-js" lang="en"><!--<![endif]-->
<head>
<meta charset="utf-8">
<title>Golang Reflect 101 &#8211; kosl90's Blog</title>
<meta name="description" content="golang reflect 101">
<meta name="keywords" content="golang, go">

<!-- Twitter Cards -->
<meta name="twitter:card" content="summary_large_image">
<meta name="twitter:image" content="http://kosl90.github.io/images/abstract-3.jpg">

<meta name="twitter:title" content="Golang Reflect 101">
<meta name="twitter:description" content="golang reflect 101">
<meta name="twitter:creator" content="@kosl90">

<!-- Open Graph -->
<meta property="og:locale" content="en_US">
<meta property="og:type" content="article">
<meta property="og:title" content="Golang Reflect 101">
<meta property="og:description" content="golang reflect 101">
<meta property="og:url" content="http://kosl90.github.io/golang-reflect-101">
<meta property="og:site_name" content="kosl90's Blog">





<link rel="canonical" href="http://kosl90.github.io/golang-reflect-101">
<link href="http://kosl90.github.io/feed.xml" type="application/atom+xml" rel="alternate" title="kosl90's Blog Feed">


<!-- http://t.co/dKP3o1e -->
<meta name="HandheldFriendly" content="True">
<meta name="MobileOptimized" content="320">
<meta name="viewport" content="width=device-width, initial-scale=1.0">

<!-- For all browsers -->
<link rel="stylesheet" href="http://kosl90.github.io/assets/css/main.min.css">
<!-- Webfonts -->
<link href="http://fonts.googleapis.com/css?family=Lato:300,400,700,300italic,400italic" rel="stylesheet" type="text/css">

<meta http-equiv="cleartype" content="on">

<!-- Load Modernizr -->
<script src="http://kosl90.github.io/assets/js/vendor/modernizr-2.6.2.custom.min.js"></script>

<!-- Icons -->
<!-- 16x16 -->
<link rel="shortcut icon" href="http://kosl90.github.io/favicon.ico">
<!-- 32x32 -->
<link rel="shortcut icon" href="http://kosl90.github.io/favicon.png">
<!-- 57x57 (precomposed) for iPhone 3GS, pre-2011 iPod Touch and older Android devices -->
<link rel="apple-touch-icon-precomposed" href="http://kosl90.github.io/images/apple-touch-icon-precomposed.png">
<!-- 72x72 (precomposed) for 1st generation iPad, iPad 2 and iPad mini -->
<link rel="apple-touch-icon-precomposed" sizes="72x72" href="http://kosl90.github.io/images/apple-touch-icon-72x72-precomposed.png">
<!-- 114x114 (precomposed) for iPhone 4, 4S, 5 and post-2011 iPod Touch -->
<link rel="apple-touch-icon-precomposed" sizes="114x114" href="http://kosl90.github.io/images/apple-touch-icon-114x114-precomposed.png">
<!-- 144x144 (precomposed) for iPad 3rd and 4th generation -->
<link rel="apple-touch-icon-precomposed" sizes="144x144" href="http://kosl90.github.io/images/apple-touch-icon-144x144-precomposed.png">




<style type="text/css">body {background-image:url(http://kosl90.github.io/images/retina_dust.png);}</style>


</head>

<body id="post" class="feature">

<!--[if lt IE 9]><div class="upgrade"><strong><a href="http://whatbrowser.org/">Your browser is quite old!</strong> Why not upgrade to a different browser to better enjoy this site?</a></div><![endif]-->
<nav id="dl-menu" class="dl-menuwrapper" role="navigation">
	<button class="dl-trigger">Open Menu</button>
	<ul class="dl-menu">
		<li><a href="http://kosl90.github.io">Home</a></li>
		<li>
			<a href="#">About</a>
			<ul class="dl-submenu">
				<li>
					<img src="http://kosl90.github.io/images/avatar.jpg" alt="Lee photo" class="author-photo">
					<h4>Lee</h4>
					<p>Be gentle, be patient, be a man.</p>
				</li>
				<li><a href="http://kosl90.github.io/about/">Learn More</a></li>
				<li>
					<a href="mailto:kos1990l@gmail.com"><i class="fa fa-envelope"></i> Email</a>
				</li>
				<li>
					<a href="http://twitter.com/kosl90"><i class="fa fa-twitter"></i> Twitter</a>
				</li>
				<li>
					<a href="http://facebook.com/kosl90"><i class="fa fa-facebook"></i> Facebook</a>
				</li>
				
				
				<li>
					<a href="http://github.com/kosl90"><i class="fa fa-github"></i> GitHub</a>
				</li>
				
				
				
				
			</ul><!-- /.dl-submenu -->
		</li>
		<li>
			<a href="#">Posts</a>
			<ul class="dl-submenu">
				<li><a href="http://kosl90.github.io/posts/">All Posts</a></li>
				<li><a href="http://kosl90.github.io/tags/">All Tags</a></li>
			</ul>
		</li>
                <li>
                    <a href="#">Links</a>
                    <ul class="dl-submenu">
                        <li><a href="http://randomk.gitcafe.com">RandomK</a></li>
                    
                        <li><a href="http://blog.csdn.net/kosl90">Old Blog</a></li>
                    </ul>
                </li>
                <li><a href="http://kosl90.github.io/feed.xml">Feed</a></li>
        </ul><!-- /.dl-menu -->
</nav><!-- /.dl-menuwrapper -->



<div class="entry-header">
  <div class="image-credit">Image source: <a href="http://www.dargadgetz.com/ios-7-abstract-wallpaper-pack-for-iphone-5-and-ipod-touch-retina/">dargadgetz</a></div><!-- /.image-credit -->
  <div class="entry-image">
    <img src="http://kosl90.github.io/images/abstract-3.jpg" alt="Golang Reflect 101">
  </div><!-- /.entry-image -->
</div><!-- /.entry-header -->


<div id="main" role="main">
  <article class="hentry">
    <header class="header-title">
      <div class="header-title-wrap">
        
          <h1 class="entry-title"><a href="http://kosl90.github.io/golang-reflect-101" rel="bookmark" title="Golang Reflect 101">Golang Reflect 101</a></h1>
        
        <h2>June 20, 2014</h2>
        
      </div><!-- /.header-title-wrap -->
    </header>
    <div class="entry-content">
      <p>元编程是一个很有意思东西，正好golang中包含了一个reflect包提供反射功能，上周末看了看reflect包，在此记录一下学习体会。</p>

<h2>元编程</h2>

<p>首先，了解一下元编程及其相关概念。元编程是什么？元编程就是普通的编程。那么为什么会有元编程这个概念呢？这是因为元编程会做出一些比普通编程行为更酷的行为，它能够通过写好的代码来处理代码，因此给它起了一个新名字以示区分。听起来有些矛盾和拗口，下面来看一个例子说明一下吧。</p>

<p>有过Qt或者MFC编程经验的人都知道，如果我们想要给按钮或者其他控件添加对某个事件的响应处理函数，只需要按照一定的明明规范来命名一个函数即可。例如在Qt中，想要对一个名叫btn的按钮绑定一个点击事件的处理函数只需要位该函数命名为<code>on_btn_clicked</code>即可。但是，我们并没有显示的将该函数和btn连接在一起，这是怎么做到的呢？Qt中一些代码会分析函数名，当检测到以<code>on_objectname_signalname</code>命名的函数时，Qt会自动将该函数和<code>objectname</code>对象的<code>signalname</code>信号绑定。这就是元编程，通过代码来对其他代码进行处理。</p>

<h2>反射(reflection)和内省(type introspection)</h2>

<p><a href="http://en.wikipedia.org/wiki/Reflection_(computer_science)">反射</a>和<a href="http://en.wikipedia.org/wiki/Introspection_(computer_science)">内省</a>是和元编程息息相关的两个概念，这两个概念非常相似，但却有很大的不同。</p>
<div class="highlight"><pre><code class="language-text" data-lang="text">**内省**是在运行时检查对象的类型和属性的能力，**反射**是在运行时检查和修改程序结构和行为的能力。
</code></pre></div>
<p>可以看出，反射比内省更加强大，内省是反射的子集，这一点不应该混淆。有些为地方可以看到说自省和反射是一回事，我想这个自省应该是根据<code>introspection</code>来翻译的，而<code>introspection</code>是<code>type introspection</code>的简称。so，不要相信那些人，他们应该去补习了。</p>

<h2>golang reflect</h2>

<p>在golang中，提供了一个<code>reflect</code>包，这个包主要包含了两个主要类型<code>Type</code>和<code>Value</code>，并且在<code>reflect</code>包中还提供了两个非常方便的函数<code>TypeOf</code>和<code>ValueOf</code>来分别获得这两种类型。下面来看一段示例代码：</p>

<div class="highlight"><pre><code class="go"><span class="kn">package</span> <span class="nx">main</span>

<span class="kn">import</span> <span class="p">(</span>
    <span class="s">&quot;fmt&quot;</span>
    <span class="s">&quot;reflect&quot;</span>
    <span class="s">&quot;regexp&quot;</span>
<span class="p">)</span>

<span class="kd">type</span> <span class="nx">Struct</span> <span class="kd">struct</span> <span class="p">{</span>
    <span class="nx">Pub</span> <span class="kt">string</span>
    <span class="nx">pri</span> <span class="kt">int</span> <span class="s">`pri:&quot;private&quot;`</span>
<span class="p">}</span>

<span class="kd">func</span> <span class="p">(</span><span class="nx">s</span> <span class="o">*</span><span class="nx">Struct</span><span class="p">)</span> <span class="nx">Pri</span><span class="p">()</span> <span class="kt">int</span> <span class="p">{</span>
    <span class="k">return</span> <span class="nx">s</span><span class="p">.</span><span class="nx">pri</span>
<span class="p">}</span>

<span class="kd">func</span> <span class="p">(</span><span class="nx">s</span> <span class="o">*</span><span class="nx">Struct</span><span class="p">)</span> <span class="nx">sum</span><span class="p">(</span><span class="nx">o</span> <span class="kt">int</span><span class="p">)</span> <span class="kt">int</span> <span class="p">{</span>
    <span class="k">return</span> <span class="nx">s</span><span class="p">.</span><span class="nx">pri</span> <span class="o">+</span> <span class="nx">o</span>
<span class="p">}</span>

<span class="kd">func</span> <span class="p">(</span><span class="nx">s</span> <span class="o">*</span><span class="nx">Struct</span><span class="p">)</span> <span class="nx">Sum</span><span class="p">(</span><span class="nx">o</span> <span class="kt">int</span><span class="p">)</span> <span class="kt">int</span> <span class="p">{</span>
    <span class="nx">s</span><span class="p">.</span><span class="nx">pri</span> <span class="p">=</span> <span class="nx">s</span><span class="p">.</span><span class="nx">sum</span><span class="p">(</span><span class="nx">o</span><span class="p">)</span>
    <span class="k">return</span> <span class="nx">s</span><span class="p">.</span><span class="nx">pri</span>
<span class="p">}</span>

<span class="kd">func</span> <span class="p">(</span><span class="nx">s</span> <span class="o">*</span><span class="nx">Struct</span><span class="p">)</span> <span class="nx">Name</span><span class="p">(</span><span class="nx">firstName</span><span class="p">,</span> <span class="nx">lastName</span> <span class="kt">string</span><span class="p">)</span> <span class="kt">string</span> <span class="p">{</span>
    <span class="k">return</span> <span class="nx">firstName</span> <span class="o">+</span> <span class="s">&quot; &quot;</span> <span class="o">+</span> <span class="nx">lastName</span>
<span class="p">}</span>

<span class="kd">func</span> <span class="nx">sum</span><span class="p">(</span><span class="nx">a</span><span class="p">,</span> <span class="nx">b</span> <span class="kt">int</span><span class="p">)</span> <span class="kt">int</span> <span class="p">{</span>
    <span class="k">return</span> <span class="nx">a</span> <span class="o">+</span> <span class="nx">b</span>
<span class="p">}</span>

<span class="kd">func</span> <span class="nx">main</span><span class="p">()</span> <span class="p">{</span>
    <span class="nx">s</span> <span class="o">:=</span> <span class="o">&amp;</span><span class="nx">Struct</span><span class="p">{}</span>
    <span class="nx">v</span> <span class="o">:=</span> <span class="nx">reflect</span><span class="p">.</span><span class="nx">ValueOf</span><span class="p">(</span><span class="nx">s</span><span class="p">)</span>
    <span class="nx">t</span> <span class="o">:=</span> <span class="nx">reflect</span><span class="p">.</span><span class="nx">TypeOf</span><span class="p">(</span><span class="nx">s</span><span class="p">)</span>

    <span class="nx">fmt</span><span class="p">.</span><span class="nx">Println</span><span class="p">(</span><span class="s">&quot;Type:&quot;</span><span class="p">,</span> <span class="nx">t</span><span class="p">)</span>
    <span class="nx">fmt</span><span class="p">.</span><span class="nx">Println</span><span class="p">(</span><span class="s">&quot;Value:&quot;</span><span class="p">,</span> <span class="nx">v</span><span class="p">)</span>
    <span class="nx">fmt</span><span class="p">.</span><span class="nx">Println</span><span class="p">(</span><span class="s">&quot;Kind:&quot;</span><span class="p">,</span> <span class="nx">t</span><span class="p">.</span><span class="nx">Kind</span><span class="p">())</span>

    <span class="k">for</span> <span class="nx">i</span> <span class="o">:=</span> <span class="mi">0</span><span class="p">;</span> <span class="nx">i</span> <span class="p">&lt;</span> <span class="nx">t</span><span class="p">.</span><span class="nx">Elem</span><span class="p">().</span><span class="nx">NumField</span><span class="p">();</span> <span class="nx">i</span><span class="o">++</span> <span class="p">{</span>
        <span class="nx">f</span> <span class="o">:=</span> <span class="nx">t</span><span class="p">.</span><span class="nx">Elem</span><span class="p">().</span><span class="nx">Field</span><span class="p">(</span><span class="nx">i</span><span class="p">)</span>
        <span class="nx">fmt</span><span class="p">.</span><span class="nx">Printf</span><span class="p">(</span><span class="s">&quot;struct field %d: %s, %s， embeded?: %v, tag: %v\n&quot;</span><span class="p">,</span> <span class="nx">i</span><span class="p">,</span> <span class="nx">f</span><span class="p">.</span><span class="nx">Name</span><span class="p">,</span> <span class="nx">f</span><span class="p">.</span><span class="nx">Type</span><span class="p">,</span> <span class="nx">f</span><span class="p">.</span><span class="nx">Anonymous</span><span class="p">,</span> <span class="nx">f</span><span class="p">.</span><span class="nx">Tag</span><span class="p">)</span>
    <span class="p">}</span>
    <span class="k">for</span> <span class="nx">i</span> <span class="o">:=</span> <span class="mi">0</span><span class="p">;</span> <span class="nx">i</span> <span class="p">&lt;</span> <span class="nx">t</span><span class="p">.</span><span class="nx">NumMethod</span><span class="p">();</span> <span class="nx">i</span><span class="o">++</span> <span class="p">{</span>
        <span class="nx">m</span> <span class="o">:=</span> <span class="nx">t</span><span class="p">.</span><span class="nx">Method</span><span class="p">(</span><span class="nx">i</span><span class="p">)</span>
        <span class="nx">fmt</span><span class="p">.</span><span class="nx">Printf</span><span class="p">(</span><span class="s">&quot;struct field %d: %s, %s\n&quot;</span><span class="p">,</span> <span class="nx">i</span><span class="p">,</span> <span class="nx">m</span><span class="p">.</span><span class="nx">Name</span><span class="p">,</span> <span class="nx">m</span><span class="p">.</span><span class="nx">Type</span><span class="p">)</span>
    <span class="p">}</span>

    <span class="nx">callMethod</span> <span class="o">:=</span> <span class="kd">func</span><span class="p">(</span><span class="nx">s</span> <span class="nx">reflect</span><span class="p">.</span><span class="nx">Value</span><span class="p">,</span> <span class="nx">methodName</span> <span class="kt">string</span><span class="p">,</span> <span class="nx">methodArgs</span> <span class="o">...</span><span class="nx">reflect</span><span class="p">.</span><span class="nx">Value</span><span class="p">)</span> <span class="p">([]</span><span class="nx">reflect</span><span class="p">.</span><span class="nx">Value</span><span class="p">,</span> <span class="kt">error</span><span class="p">)</span> <span class="p">{</span>
        <span class="nx">t</span> <span class="o">:=</span> <span class="nx">s</span><span class="p">.</span><span class="nx">Type</span><span class="p">()</span>
        <span class="nx">method</span><span class="p">,</span> <span class="nx">exist</span> <span class="o">:=</span> <span class="nx">t</span><span class="p">.</span><span class="nx">MethodByName</span><span class="p">(</span><span class="nx">methodName</span><span class="p">)</span>
        <span class="k">if</span> <span class="p">!</span><span class="nx">exist</span> <span class="p">{</span>
            <span class="k">return</span> <span class="kc">nil</span><span class="p">,</span> <span class="nx">fmt</span><span class="p">.</span><span class="nx">Errorf</span><span class="p">(</span><span class="s">&quot;\&quot;%s\&quot;: is not existed for %s&quot;</span><span class="p">,</span> <span class="nx">methodName</span><span class="p">,</span> <span class="nx">t</span><span class="p">)</span>
        <span class="p">}</span>

        <span class="k">if</span> <span class="nx">regexp</span><span class="p">.</span><span class="nx">MustCompile</span><span class="p">(</span><span class="s">`^[a-z]`</span><span class="p">).</span><span class="nx">MatchString</span><span class="p">(</span><span class="nx">method</span><span class="p">.</span><span class="nx">Name</span><span class="p">)</span> <span class="p">{</span>
            <span class="k">return</span> <span class="kc">nil</span><span class="p">,</span> <span class="nx">fmt</span><span class="p">.</span><span class="nx">Errorf</span><span class="p">(</span><span class="s">&quot;\&quot;%s\&quot;: unexported field cannot be called&quot;</span><span class="p">,</span> <span class="nx">method</span><span class="p">.</span><span class="nx">Name</span><span class="p">)</span>
        <span class="p">}</span>

        <span class="nx">args</span> <span class="o">:=</span> <span class="p">[]</span><span class="nx">reflect</span><span class="p">.</span><span class="nx">Value</span><span class="p">{</span><span class="nx">s</span><span class="p">}</span>
        <span class="nx">args</span> <span class="p">=</span> <span class="nb">append</span><span class="p">(</span><span class="nx">args</span><span class="p">,</span> <span class="nx">methodArgs</span><span class="o">...</span><span class="p">)</span>

        <span class="k">return</span> <span class="nx">method</span><span class="p">.</span><span class="nx">Func</span><span class="p">.</span><span class="nx">Call</span><span class="p">(</span><span class="nx">args</span><span class="p">),</span> <span class="kc">nil</span>
    <span class="p">}</span>

    <span class="nx">fmt</span><span class="p">.</span><span class="nx">Print</span><span class="p">(</span><span class="s">&quot;call Struct.Pri: &quot;</span><span class="p">)</span>
    <span class="nx">fmt</span><span class="p">.</span><span class="nx">Println</span><span class="p">(</span><span class="nx">callMethod</span><span class="p">(</span><span class="nx">v</span><span class="p">,</span> <span class="s">&quot;Pri&quot;</span><span class="p">))</span>

    <span class="nx">fmt</span><span class="p">.</span><span class="nx">Print</span><span class="p">(</span><span class="s">&quot;call Struct.Sum: &quot;</span><span class="p">)</span>
    <span class="nx">fmt</span><span class="p">.</span><span class="nx">Println</span><span class="p">(</span><span class="nx">callMethod</span><span class="p">(</span><span class="nx">v</span><span class="p">,</span> <span class="s">&quot;Sum&quot;</span><span class="p">,</span> <span class="nx">reflect</span><span class="p">.</span><span class="nx">ValueOf</span><span class="p">(</span><span class="mi">1</span><span class="p">)))</span>

    <span class="nx">fmt</span><span class="p">.</span><span class="nx">Print</span><span class="p">(</span><span class="s">&quot;call Struct.Name: &quot;</span><span class="p">)</span>
    <span class="nx">fmt</span><span class="p">.</span><span class="nx">Println</span><span class="p">(</span><span class="nx">callMethod</span><span class="p">(</span><span class="nx">v</span><span class="p">,</span> <span class="s">&quot;Name&quot;</span><span class="p">,</span> <span class="nx">reflect</span><span class="p">.</span><span class="nx">ValueOf</span><span class="p">(</span><span class="s">&quot;David&quot;</span><span class="p">),</span> <span class="nx">reflect</span><span class="p">.</span><span class="nx">ValueOf</span><span class="p">(</span><span class="s">&quot;Beckham&quot;</span><span class="p">)))</span>

    <span class="nx">fmt</span><span class="p">.</span><span class="nx">Print</span><span class="p">(</span><span class="s">&quot;call Struct.sum: &quot;</span><span class="p">)</span>
    <span class="nx">fmt</span><span class="p">.</span><span class="nx">Println</span><span class="p">(</span><span class="nx">callMethod</span><span class="p">(</span><span class="nx">v</span><span class="p">,</span> <span class="s">&quot;sum&quot;</span><span class="p">,</span> <span class="nx">reflect</span><span class="p">.</span><span class="nx">ValueOf</span><span class="p">(</span><span class="mi">1</span><span class="p">)))</span>

    <span class="nx">fmt</span><span class="p">.</span><span class="nx">Print</span><span class="p">(</span><span class="s">&quot;call Struct.s: &quot;</span><span class="p">)</span>
    <span class="nx">fmt</span><span class="p">.</span><span class="nx">Println</span><span class="p">(</span><span class="nx">callMethod</span><span class="p">(</span><span class="nx">v</span><span class="p">,</span> <span class="s">&quot;s&quot;</span><span class="p">))</span>

    <span class="nx">fn</span> <span class="o">:=</span> <span class="nx">reflect</span><span class="p">.</span><span class="nx">ValueOf</span><span class="p">(</span><span class="nx">sum</span><span class="p">)</span>
    <span class="nx">ft</span> <span class="o">:=</span> <span class="nx">fn</span><span class="p">.</span><span class="nx">Type</span><span class="p">()</span>
    <span class="k">for</span> <span class="nx">i</span> <span class="o">:=</span> <span class="mi">0</span><span class="p">;</span> <span class="nx">i</span> <span class="p">&lt;</span> <span class="nx">ft</span><span class="p">.</span><span class="nx">NumIn</span><span class="p">();</span> <span class="nx">i</span><span class="o">++</span> <span class="p">{</span>
        <span class="nx">in</span> <span class="o">:=</span> <span class="nx">ft</span><span class="p">.</span><span class="nx">In</span><span class="p">(</span><span class="nx">i</span><span class="p">)</span>
        <span class="nx">fmt</span><span class="p">.</span><span class="nx">Printf</span><span class="p">(</span><span class="s">&quot;function argument %d: %s\n&quot;</span><span class="p">,</span> <span class="nx">i</span><span class="p">,</span> <span class="nx">in</span><span class="p">)</span>
    <span class="p">}</span>
    <span class="k">for</span> <span class="nx">i</span> <span class="o">:=</span> <span class="mi">0</span><span class="p">;</span> <span class="nx">i</span> <span class="p">&lt;</span> <span class="nx">ft</span><span class="p">.</span><span class="nx">NumOut</span><span class="p">();</span> <span class="nx">i</span><span class="o">++</span> <span class="p">{</span>
        <span class="nx">out</span> <span class="o">:=</span> <span class="nx">ft</span><span class="p">.</span><span class="nx">In</span><span class="p">(</span><span class="nx">i</span><span class="p">)</span>
        <span class="nx">fmt</span><span class="p">.</span><span class="nx">Printf</span><span class="p">(</span><span class="s">&quot;function return value %d: %s\n&quot;</span><span class="p">,</span> <span class="nx">i</span><span class="p">,</span> <span class="nx">out</span><span class="p">)</span>
    <span class="p">}</span>

    <span class="nx">i</span><span class="p">,</span> <span class="nx">j</span> <span class="o">:=</span> <span class="mi">1</span><span class="p">,</span> <span class="mi">3</span>
    <span class="nx">fmt</span><span class="p">.</span><span class="nx">Printf</span><span class="p">(</span><span class="s">&quot;Call sum(%d, %d) function: %v\n&quot;</span><span class="p">,</span>
        <span class="nx">i</span><span class="p">,</span> <span class="nx">j</span><span class="p">,</span>
        <span class="nx">fn</span><span class="p">.</span><span class="nx">Call</span><span class="p">([]</span><span class="nx">reflect</span><span class="p">.</span><span class="nx">Value</span><span class="p">{</span>
            <span class="nx">reflect</span><span class="p">.</span><span class="nx">ValueOf</span><span class="p">(</span><span class="nx">i</span><span class="p">),</span>
            <span class="nx">reflect</span><span class="p">.</span><span class="nx">ValueOf</span><span class="p">(</span><span class="nx">j</span><span class="p">),</span>
        <span class="p">})[</span><span class="mi">0</span><span class="p">].</span><span class="nx">Interface</span><span class="p">(),</span>
    <span class="p">)</span>
<span class="p">}</span></code></pre></div>

<p>如果运行这段代码会得到一下输出：</p>

<div class="highlight"><pre><code class="bash">Type: *main.Struct
Value: &lt;*main.Struct Value&gt;
Kind: ptr
struct field 0: Pub, string, embeded?: <span class="nb">false</span>, tag: 
struct field 1: pri, int, embeded?: <span class="nb">false</span>, tag: pri:<span class="s2">&quot;private&quot;</span>
struct field 0: Name, func<span class="o">(</span>*main.Struct, string, string<span class="o">)</span> string
struct field 1: Pri, func<span class="o">(</span>*main.Struct<span class="o">)</span> int
struct field 2: Sum, func<span class="o">(</span>*main.Struct, int<span class="o">)</span> int
struct field 3: sum, func<span class="o">(</span>*main.Struct, int<span class="o">)</span> int
call Struct.Pri: <span class="o">[</span>&lt;int Value&gt;<span class="o">]</span> &lt;nil&gt;
call Struct.Sum: <span class="o">[</span>&lt;int Value&gt;<span class="o">]</span> &lt;nil&gt;
call Struct.Name: <span class="o">[</span>David Beckham<span class="o">]</span> &lt;nil&gt;
call Struct.sum: <span class="o">[]</span> <span class="s2">&quot;sum&quot;</span>: unexported field cannot be called
call Struct.s: <span class="o">[]</span> <span class="s2">&quot;s&quot;</span>: is not existed <span class="k">for</span> *main.Struct
<span class="k">function </span>argument 0: int
<span class="k">function </span>argument 1: int
<span class="k">function return </span>value 0: int
Call sum<span class="o">(</span>1, 3<span class="o">)</span> <span class="k">function</span>: 4</code></pre></div>

<h2>代码分析</h2>

<p>这段代码虽然有点长，不过却非常简单和清晰，现在来分析一下这段代码及其输出结果。</p>

<p>在代码的开始部分，通过<code>reflect.ValueOf</code>来获取<code>Struct</code>结构体指针的值信息，通过<code>reflect.TypeOf</code>来获取<code>Struct</code>结构体指针的类型信息，需要留意的地方是，这里创建的是一个<code>Struct</code>的结构体指针，而不是一个<code>Struct</code>结构体。</p>

<h3>Kind</h3>

<p>在代码的第47行调用了一个叫<code>Kind</code>的方法，<code>Kind</code>方法是用来表示一个<code>Type</code>是属于哪一种类型的，因此，通过<code>Kind</code>方法也可以准确的判断出这是一个<code>ptr</code>。</p>

<h3>Elem</h3>

<p>在遍历结构体字段时用到了一个叫<code>Elem</code>的方法，由于<code>s</code>是一个指针类型，因此需要通过<code>Value.Elem</code>得到结构体的值信息，这样才能获取<code>Struct</code>结构体中的字段信息。同时需要注意，<code>Value.Elem</code>方法只对指针和接口——例如<code>error</code>——有效。</p>

<p>在<code>reflect.Value</code>和<code>reflect.Type</code>中有不少命名相同的方法，不过意义却不一样，<code>Elem</code>就是一个典型的例子，与<code>Value.Elem</code>不同，在<code>reflect.Type</code>中<code>Type.Elem</code>用来可以用来表示map中值的类型。</p>

<h3>struct tag</h3>

<p>在golang中有一个被成为<code>struct tag</code>的东西，每次见到这个东西都感觉怪怪的，通常也很少使用。</p>

<p><code>struct tag</code>通常是一个用空格分隔的键值对，在键中不包含双引号，冒号和空格，而值则是由双引号引起来的任意字符。</p>

<p>不过鉴于<code>struct tag</code>是一个字符串，而<code>reflect.StructTag</code>本身其实也是一个字符串，也许可以在适当的时候自由发挥一下。另外，<code>reflect.StructTag</code>只有一个<code>Get</code>方法。</p>

<p>下面是来自<code>reflect</code>包文档中的一个例子，更详细的展示了<code>struct tag</code>的用法：</p>

<div class="highlight"><pre><code class="go"><span class="kn">package</span> <span class="nx">main</span>

<span class="kn">import</span> <span class="p">(</span>
    <span class="s">&quot;fmt&quot;</span>
    <span class="s">&quot;reflect&quot;</span>
<span class="p">)</span>

<span class="kd">func</span> <span class="nx">main</span><span class="p">()</span> <span class="p">{</span>
    <span class="kd">type</span> <span class="nx">S</span> <span class="kd">struct</span> <span class="p">{</span>
        <span class="nx">F</span> <span class="kt">string</span> <span class="s">`species:&quot;gopher&quot; color:&quot;blue&quot;`</span>
    <span class="p">}</span>

    <span class="nx">s</span> <span class="o">:=</span> <span class="nx">S</span><span class="p">{}</span>
    <span class="nx">st</span> <span class="o">:=</span> <span class="nx">reflect</span><span class="p">.</span><span class="nx">TypeOf</span><span class="p">(</span><span class="nx">s</span><span class="p">)</span>
    <span class="nx">field</span> <span class="o">:=</span> <span class="nx">st</span><span class="p">.</span><span class="nx">Field</span><span class="p">(</span><span class="mi">0</span><span class="p">)</span>
    <span class="nx">fmt</span><span class="p">.</span><span class="nx">Println</span><span class="p">(</span><span class="nx">field</span><span class="p">.</span><span class="nx">Tag</span><span class="p">.</span><span class="nx">Get</span><span class="p">(</span><span class="s">&quot;color&quot;</span><span class="p">),</span> <span class="nx">field</span><span class="p">.</span><span class="nx">Tag</span><span class="p">.</span><span class="nx">Get</span><span class="p">(</span><span class="s">&quot;species&quot;</span><span class="p">))</span>

<span class="p">}</span></code></pre></div>

<h3>Method and Call</h3>

<p>接下来是<code>callMethod</code>函数。在<code>callMethod</code>函数中有几个地方需要注意。</p>

<p>首先是通过<code>reflect.Type</code>中的<code>MethodByName</code>方法来获取<code>reflect.Method</code>类型的方法信息，以及判断该方法是否存在。</p>

<p>如果你愿意，同样可以使用<code>reflect.Value</code>中的<code>MethodByName</code>方法来获得<code>reflect.Value</code>类型的方法信息，然后通过<code>Value.IsValid</code>来判断该方法是否存在。这里的<code>reflect.Value</code>类型的信息等于<code>reflect.Method</code>类型中的<code>Func</code>字段。</p>

<p>第二个需要注意的地方时这里通过使用正则表达式来判断方法的名字的首字母大小写来判断该方法是否导出，这是由于<code>reflect</code>包中似乎并没有提供可以判断方法和字段是否导出的方法。</p>

<p>第三，在调用一个结构体方法时，需要将<code>receiver</code>作为第一个参数传递个方法。</p>

<h3>Value.Type()</h3>

<p>在对<code>sum</code>进行反射时并没有使用<code>reflect.TypeOf</code>，而是使用了<code>Value.Type</code>方法，这个方法同样可以得到类型信息。</p>

<h3>Interface</h3>

<p>在代码的最后一部分取得返回值时使用了<code>Value.Interface</code>方法。该方法的作用是返回一个<code>interface{}</code>以便能够获取真正的值。</p>

<h2>改变对象的值</h2>

<p><code>reflect</code>包出了获取各种信息以外，还可以改变变量的值。一个对象能否设值，可以通过<code>Value.CanSet</code>方法来判断。不过需要记住，只有指针类型通过<code>Elem</code>函数来得到真正的对象才能设值。这是因为在<a href="http://golang.org/doc/articles/laws_of_reflection.html">laws of reflection</a>中有这么一句话：</p>

<blockquote>
<p>Just keep in mind that reflection Values need the address of something in order to modify what they represent.</p>
</blockquote>

<h2>总结</h2>

<p><code>reflect</code>保重常用的方法克功能基本都涉及到了，不过并没有事无巨细的讲解，还有channel，slice，map，embeded field等没涉及到，更详细的内容只有一边在实际中去探索，一边参看引用，才会更有意义。希望元编程能够在适当的地方改善我们的生活。</p>

<h2>reference</h2>

<ol>
<li><a href="http://golang.org/pkg/reflect/">golang reflect package document</a>.</li>
<li><a href="http://golang.org/doc/articles/laws_of_reflection.html">laws of reflection</a>.(注：网上有有中文翻译版本。)</li>
</ol>

      <footer class="entry-meta">
        <span class="entry-tags"><a href="http://kosl90.github.io/tags/#golang" title="Pages tagged golang" class="tag">golang</a><a href="http://kosl90.github.io/tags/#go" title="Pages tagged go" class="tag">go</a></span>
        <span><a href="http://kosl90.github.io/golang-reflect-101" rel="bookmark" title="Golang Reflect 101">Golang Reflect 101</a> was published on <span class="entry-date date published updated"><time datetime="2014-06-20T00:00:00+08:00">June 20, 2014</time></span></span>
        (revised: <span class="entry-date date modified"><time datetime="2014-02-22">02/22/2014</time></span>)
        <span class="author vcard"><span class="fn"><a href="http://kosl90.github.io/about/" title="About Lee">Lee</a></span></span>
        <div class="social-share">
          <ul class="socialcount socialcount-small inline-list">
            <li class="facebook"><a href="https://www.facebook.com/sharer/sharer.php?u=http://kosl90.github.io/golang-reflect-101" title="Share on Facebook"><span class="count"><i class="fa fa-facebook-square"></i> Like</span></a></li>
            <li class="twitter"><a href="https://twitter.com/intent/tweet?text=http://kosl90.github.io/golang-reflect-101" title="Share on Twitter"><span class="count"><i class="fa fa-twitter-square"></i> Tweet</span></a></li>
            <li class="googleplus"><a href="https://plus.google.com/share?url=http://kosl90.github.io/golang-reflect-101" title="Share on Google Plus"><span class="count"><i class="fa fa-google-plus-square"></i> +1</span></a></li>
          </ul>
        </div><!-- /.social-share -->
      </footer>
    </div><!-- /.entry-content -->
    <section id="disqus_thread"></section><!-- /#disqus_thread -->
    
    <div class="read-more">
      
        <div class="read-more-header">
          <a href="http://kosl90.github.io/bit-getter-and-setter" class="read-more-btn">Read More</a>
        </div><!-- /.read-more-header -->
        <div class="read-more-content">
          <h3><a href="http://kosl90.github.io/interview" title="2016找工作记1 - 一次面试的反思">2016找工作记1 - 一次面试的反思</a></h3>
          <p>2016找工作记1，一次面试的反思 <a href="http://kosl90.github.io/interview">Continue reading</a></p>
        </div><!-- /.read-more-content -->
      
      <div class="read-more-list">
        
          <div class="list-item">
            <h4><a href="http://kosl90.github.io/bit-getter-and-setter" title="Bit Getter and Setter">Bit Getter and Setter</a></h4>
            <span>Published on March 09, 2014</span>
          </div><!-- /.list-item -->
        
          <div class="list-item">
            <h4><a href="http://kosl90.github.io/fix-newline-to-space" title="Fix Newline to Space">Fix Newline to Space</a></h4>
            <span>Published on February 23, 2014</span>
          </div><!-- /.list-item -->
        
      </div><!-- /.read-more-list -->
      
    </div><!-- /.read-more -->
  </article>
</div><!-- /#main -->

<div class="footer-wrapper">
  <footer role="contentinfo">
    <span>&copy; 2016 Lee. Powered by <a href="http://jekyllrb.com">Jekyll</a> using the <a href="http://mademistakes.com/hpstr/">HPSTR Theme</a>.</span>
  </footer>
</div><!-- /.footer-wrapper -->

<script src="http://kosl90.github.io/assets/js/vendor/echo.min.js"></script>
<script>Echo.init({offset:'200',throttle: 250});</script>
<!-- <script src="//ajax.googleapis.com/ajax/libs/jquery/1.9.1/jquery.min.js"></script> -->
<script>window.jQuery || document.write('<script src="http://kosl90.github.io/assets/js/vendor/jquery-1.9.1.min.js"><\/script>')</script>
<script src="http://kosl90.github.io/assets/js/scripts.min.js"></script>
<script src="http://kosl90.github.io/assets/js/plugins/jquery.fancybox.pack.js"></script>
<script>(function($){$(".fancybox").fancybox();})(jQuery);</script>


<script>
  (function(i,s,o,g,r,a,m){i['GoogleAnalyticsObject']=r;i[r]=i[r]||function(){
  (i[r].q=i[r].q||[]).push(arguments)},i[r].l=1*new Date();a=s.createElement(o),
  m=s.getElementsByTagName(o)[0];a.async=1;a.src=g;m.parentNode.insertBefore(a,m)
  })(window,document,'script','//www.google-analytics.com/analytics.js','ga');

ga('create', 'UA-48343245-1', 'kosl90.github.io');
  ga('send', 'pageview');

</script>


<script type="text/javascript">
/* * * CONFIGURATION VARIABLES: EDIT BEFORE PASTING INTO YOUR WEBPAGE * * */
var disqus_shortname = 'kosl90'; // required: replace example with your forum shortname

/* * * DON'T EDIT BELOW THIS LINE * * */
(function () {
 var s = document.createElement('script'); s.async = true;
 s.type = 'text/javascript';
 s.src = '//' + disqus_shortname + '.disqus.com/count.js';
 (document.getElementsByTagName('HEAD')[0] || document.getElementsByTagName('BODY')[0]).appendChild(s);
}());

(function () {
//  window.addEventListener("load", function(){ if (window.location.hash === '#disqus_thread') loadComments(); });
 var a = document.createElement("a")
 a.setAttribute("class", "load-comments");
 a.setAttribute("href", "#disqus_thread");
 var d = document.getElementById("disqus_thread");
 d.appendChild(a);

 var disqus_loaded = false;
 function loadComments() {

 if (disqus_loaded)
 return;

 disqus_loaded = true;

 var s = document.getElementsByTagName('script')[0], sp = s.parentNode;
 var dsq = document.createElement('script');
 dsq.type = 'text/javascript';
 dsq.async = true;
 dsq.src = 'http://' + disqus_shortname + '.disqus.com/embed.js';
 sp.insertBefore(dsq, s);
 }
 var loadCommentsButtons = document.querySelectorAll('.load-comments');
 for(var l = 0; l < loadCommentsButtons.length; l++) loadCommentsButtons[l].addEventListener('click', loadComments);
}());
</script>

	        

</body>
</html>
