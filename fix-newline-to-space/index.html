<!doctype html>
<!--[if lt IE 7]><html class="no-js lt-ie9 lt-ie8 lt-ie7" lang="en"> <![endif]-->
<!--[if (IE 7)&!(IEMobile)]><html class="no-js lt-ie9 lt-ie8" lang="en"><![endif]-->
<!--[if (IE 8)&!(IEMobile)]><html class="no-js lt-ie9" lang="en"><![endif]-->
<!--[if gt IE 8]><!--> <html class="no-js" lang="en"><!--<![endif]-->
<head>
<meta charset="utf-8">
<title>Fix Newline to Space &#8211; kosl90's Blog</title>
<meta name="description" content="jekyll converts newline to space, it's not good for chinese.">
<meta name="keywords" content="jekyll">

<!-- Twitter Cards -->
<meta name="twitter:card" content="summary_large_image">
<meta name="twitter:image" content="http://kosl90.github.io/images/abstract-2.jpg">

<meta name="twitter:title" content="Fix Newline to Space">
<meta name="twitter:description" content="jekyll converts newline to space, it's not good for chinese.">
<meta name="twitter:creator" content="@kosl90">

<!-- Open Graph -->
<meta property="og:locale" content="en_US">
<meta property="og:type" content="article">
<meta property="og:title" content="Fix Newline to Space">
<meta property="og:description" content="jekyll converts newline to space, it's not good for chinese.">
<meta property="og:url" content="http://kosl90.github.io/fix-newline-to-space">
<meta property="og:site_name" content="kosl90's Blog">





<link rel="canonical" href="http://kosl90.github.io/fix-newline-to-space">
<link href="http://kosl90.github.io/feed.xml" type="application/atom+xml" rel="alternate" title="kosl90's Blog Feed">


<!-- http://t.co/dKP3o1e -->
<meta name="HandheldFriendly" content="True">
<meta name="MobileOptimized" content="320">
<meta name="viewport" content="width=device-width, initial-scale=1.0">

<link href="//netdna.bootstrapcdn.com/font-awesome/4.0.3/css/font-awesome.min.css" rel="stylesheet">
<!-- For all browsers -->
<link rel="stylesheet" href="http://kosl90.github.io/assets/css/main.min.css">
<!-- Webfonts -->
<link href="http://fonts.googleapis.com/css?family=Lato:300,400,700,300italic,400italic" rel="stylesheet" type="text/css">

<meta http-equiv="cleartype" content="on">

<!-- Load Modernizr -->
<script src="http://kosl90.github.io/assets/js/vendor/modernizr-2.6.2.custom.min.js"></script>

<!-- Icons -->
<!-- 16x16 -->
<link rel="shortcut icon" href="http://kosl90.github.io/favicon.ico">
<!-- 32x32 -->
<link rel="shortcut icon" href="http://kosl90.github.io/favicon.png">
<!-- 57x57 (precomposed) for iPhone 3GS, pre-2011 iPod Touch and older Android devices -->
<link rel="apple-touch-icon-precomposed" href="http://kosl90.github.io/images/apple-touch-icon-precomposed.png">
<!-- 72x72 (precomposed) for 1st generation iPad, iPad 2 and iPad mini -->
<link rel="apple-touch-icon-precomposed" sizes="72x72" href="http://kosl90.github.io/images/apple-touch-icon-72x72-precomposed.png">
<!-- 114x114 (precomposed) for iPhone 4, 4S, 5 and post-2011 iPod Touch -->
<link rel="apple-touch-icon-precomposed" sizes="114x114" href="http://kosl90.github.io/images/apple-touch-icon-114x114-precomposed.png">
<!-- 144x144 (precomposed) for iPad 3rd and 4th generation -->
<link rel="apple-touch-icon-precomposed" sizes="144x144" href="http://kosl90.github.io/images/apple-touch-icon-144x144-precomposed.png">




<style type="text/css">body {background-image:url(http://kosl90.github.io/images/retina_dust.png);}</style>


</head>

<body id="post" class="feature" itemscope itemtype="http://schema.org/WebPage">

<!--[if lt IE 9]><div class="upgrade"><strong><a href="http://whatbrowser.org/">Your browser is quite old!</strong> Why not upgrade to a different browser to better enjoy this site?</a></div><![endif]-->
<nav id="dl-menu" class="dl-menuwrapper" role="navigation" itemscope itemtype="http://schema.org/SiteNavigationElement">
	<button class="dl-trigger">Open Menu</button>
	<ul class="dl-menu">
		<li><a href="http://kosl90.github.io">Home</a></li>
		<li>
			<a href="#">About</a>
			<ul class="dl-submenu">
				<li>
					<img src="http://kosl90.github.io/images/avatar.jpg" alt="Lee photo" class="author-photo">
					<h4>Lee</h4>
					<p>Be gentle, be patient, be a man.</p>
				</li>
				<li><a href="http://kosl90.github.io/about/">Learn More</a></li>
				<li>
					<a href="mailto:kos1990l@gmail.com"><i class="fa fa-envelope"></i> Email</a>
				</li>
				<li>
					<a href="http://twitter.com/kosl90"><i class="fa fa-twitter"></i> Twitter</a>
				</li>
				<li>
					<a href="http://facebook.com/kosl90"><i class="fa fa-facebook"></i> Facebook</a>
				</li>
				
				
				<li>
					<a href="http://github.com/kosl90"><i class="fa fa-github"></i> GitHub</a>
				</li>
				
				
				
				
			</ul><!-- /.dl-submenu -->
		</li>
		<li>
			<a href="#">Posts</a>
			<ul class="dl-submenu">
				<li><a href="http://kosl90.github.io/archive/">All Posts</a></li>
				<li><a href="http://kosl90.github.io/tags/">All Tags</a></li>
			</ul>
		</li>
		<li><a href="http://kosl90.github.io/feed.xml">Feed</a></li><li><a href="http://blog.csdn.net/kosl90">Old Blog</a></li>
	</ul><!-- /.dl-menu -->
</nav><!-- /.dl-menuwrapper -->



<div class="entry-header">
  <div class="entry-image"><img src="http://kosl90.github.io/images/abstract-2.jpg" alt="Fix Newline to Space" itemprop="image">
    
  </div><!-- /.entry-image -->
</div><!-- /.entry-header -->


<div id="main" role="main" itemprop="mainContentOfPage" itemscope itemtype="http://schema.org/Blog">
  <article class="hentry" itemprop="blogPost" itemscope itemtype="http://schema.org/BlogPosting">
    <header class="header-title">
      <div class="header-title-wrap">
        
          <h1 class="entry-title" itemprop="name"><a href="http://kosl90.github.io/fix-newline-to-space" rel="bookmark" title="Fix Newline to Space" itemprop="url">Fix Newline to Space</a></h1>
        
        <h2>February 23, 2014</h2>
      </div><!-- /.header-title-wrap -->
    </header>
    <div class="entry-content" itemprop="description">
      <p>之前，<a href="http://randomk.gitcafe.com/">RandomK</a>说我的blog有bug，其实在他说之前我就已经知道了，只是当时比较晚，所以没有修，今天周末将其解决之。</p>

<h2>原因</h2>

<p>我使用的是redcarpet作为markdown的转换器，jekyll将多行的段落转换成html之后在浏览器中显示会很奇怪，在原始的markdown中的某一行最后一个字与下一行的第一个字之间存在一个空格，作为使用单词的外国淫来说没什么问题，可是作为大天朝子民是无法忍受的。
<figure>
<img data-echo="http://kosl90.github.io/images/fix-space/space.png" alt="space" title="space">
<figcaption>文字之间存在空格</figcaption>
</figure></p>

<h2>解决方案一 段落写为一行</h2>

<p>我只能说这种行为好痛苦。</p>

<h2>解决方案二 在markdown转换为html前处理一下</h2>

<p>由于无法忍受第一种解决方案，只能在markdown转换为html之前进行一些预处理了。在网上搜索一番后发现果然不止我一人遇到此问题，并且找到了一个<a href="http://chenyufei.info/blog/2011-12-23/fix-chinese-newline-becomes-space-in-browser-problem/">解决方案</a>。不过该解决方案有一定的局限性，第一，没有处理汉英和英汉这两种情况，第二，没有处理摘要。</p>

<p>为了解决以上两个问题，必须做出一些更改。</p>

<p>首先，作为一个非octopress用户，果断得去github上将octopress的<a href="https://github.com/imathis/octopress/blob/master/plugins/post_filters.rb">post_filters plugins</a>得到，然后，从<a href="http://chenyufei.info/blog/2011-12-23/fix-chinese-newline-becomes-space-in-browser-problem/">解决 Markdown 转 HTML 中文换行变空格的问题</a>将代码拷贝并保存到存放plugins的目录。然后就可以开始修改了。</p>

<p>修改1:</p>
<div class="highlight"><pre><code class="ruby language-ruby" data-lang="ruby"><span class="k">class</span> <span class="nc">String</span>
  <span class="n">han</span> <span class="o">=</span> <span class="s1">&#39;\p{Han}|[，。？；：‘’“”、！……（）]&#39;</span>
  <span class="vc">@@hh</span> <span class="o">=</span> <span class="sr">/(</span><span class="si">#{</span><span class="n">han</span><span class="si">}</span><span class="sr">) *\n *(</span><span class="si">#{</span><span class="n">han</span><span class="si">}</span><span class="sr">)/m</span>
  <span class="vc">@@he</span> <span class="o">=</span> <span class="sr">/(</span><span class="si">#{</span><span class="n">han</span><span class="si">}</span><span class="sr">) *\n *(\p{Alpha})/m</span>
  <span class="vc">@@eh</span> <span class="o">=</span> <span class="sr">/(\p{Alpha}) *\n *(</span><span class="si">#{</span><span class="n">han</span><span class="si">}</span><span class="sr">)/m</span>
  <span class="k">def</span> <span class="nf">join_chinese!</span>
    <span class="nb">gsub!</span><span class="p">(</span><span class="vc">@@hh</span><span class="p">,</span> <span class="s1">&#39;\1\2&#39;</span><span class="p">)</span>
    <span class="nb">gsub!</span><span class="p">(</span><span class="vc">@@he</span><span class="p">,</span> <span class="s1">&#39;\1\2&#39;</span><span class="p">)</span>
    <span class="nb">gsub!</span><span class="p">(</span><span class="vc">@@eh</span><span class="p">,</span> <span class="s1">&#39;\1\2&#39;</span><span class="p">)</span>
    <span class="nb">self</span>
  <span class="k">end</span>
<span class="k">end</span>
</code></pre></div>
<p>经过修改后，blog就能够正常显示了。
<figure class="half">
<img data-echo="http://kosl90.github.io/images/fix-space/space.png" alt="space" title="space">
<img data-echo="http://kosl90.github.io/images/fix-space/no-space.png" alt="no-space" title="no space">
    <figcaption>第一阶段成果</figcaption>
</figure></p>

<p>修改2:
虽然blog中的问题解决了，但是摘要部分并没有的到解决。
<figure>
<img data-echo="http://kosl90.github.io/images/fix-space/wrong-excerpt.png" alt="wrong-excerpt" title="wrong-excerpt">
    <figcaption>摘要中显示错误</figcaption>
</figure>
由于在pre_render中添加<code>post.excerpt.join_chinese!</code>会导致jekyll创建html时失败，因此采用添加一个filter供Liquid使用，从而解决解决此问题。</p>

<p>将一下代码加入Jekyll模块中</p>
<div class="highlight"><pre><code class="ruby language-ruby" data-lang="ruby">  <span class="k">module</span> <span class="nn">TemplateJoinChineseFilter</span>
    <span class="k">def</span> <span class="nf">join_chinese</span><span class="p">(</span><span class="n">input</span><span class="p">)</span>
      <span class="n">input</span><span class="o">.</span><span class="n">join_chinese!</span>
    <span class="k">end</span>
  <span class="k">end</span>
</code></pre></div>
<p>然后将<code>Liquid::Template.register_filter(Jekyll::TemplateJoinChineseFilter)</code>添加到最后一行。最后，只需要在使用摘要的时候使用<code>{{ page.excerpt | join_chinese }}</code>替代<code>{{ page.excerpt }}</code>即可。
<figure class='half'>
<img data-echo="http://kosl90.github.io/images/fix-space/wrong-excerpt.png" alt="wrong-excerpt" title="wrong-excerpt">
<img data-echo="http://kosl90.github.io/images/fix-space/excerpt.png" alt="excerpt" title="excerpt">
<figcaption>摘要中空格也不存在了</figcaption>
</figure></p>

<h1>The End</h1>

<p>问题基本得到了解决，不过还有几点需要注意：</p>

<ol>
<li>markdown中标题与正文之间需要一行空白行（我不习惯）。</li>
<li>标点符号和数字没有处理，因此有些地方是不适合换行然后通过插件解决的。</li>
<li>应该还存在这一些bug。</li>
</ol>

<h2>Reference</h2>

<ol>
<li><a href="http://chenyufei.info/blog/2011-12-23/fix-chinese-newline-becomes-space-in-browser-problem/">解决 Markdown 转 HTML 中文换行变空格的问题</a>。</li>
<li><a href="https://github.com/imathis/octopress/blob/master/plugins/post_filters.rb">post_filter</a>。</li>
</ol>

      <footer class="entry-meta">
        <span class="entry-tags"><a href="http://kosl90.github.io/tags/index.html#jekyll" title="Pages tagged jekyll" rel="tag" class="tag">jekyll</a></span>
        <span><a href="http://kosl90.github.io/fix-newline-to-space" rel="bookmark" title="Fix Newline to Space" itemprop="url">Fix Newline to Space</a> was published on <span class="entry-date date published updated"><time datetime="2014-02-23T00:00:00+08:00" itemprop="datePublished">February 23, 2014</time></span></span>
        (revised: <span class="entry-date date modified"><time datetime="2014-02-22" itemprop="dateModified">02/22/2014</time></span>)
        <span class="author vcard" itemprop="author" itemscope itemtype="http://schema.org/Person"><span itemprop="name" class="fn"><a href="http://kosl90.github.io/about" title="About Lee" itemprop="url">Lee</a></span></span>
        <div class="social-share">
          <ul class="socialcount socialcount-small inline-list" data-url="http://kosl90.github.io/fix-newline-to-space" data-share-text="Fix Newline to Space">
            <li class="facebook"><a href="https://www.facebook.com/sharer/sharer.php?u=http://kosl90.github.io/fix-newline-to-space" title="Share on Facebook"><span class="count"><i class="icon-facebook-sign"></i> Like</span></a></li>
            <li class="twitter"><a href="https://twitter.com/intent/tweet?text=http://kosl90.github.io/fix-newline-to-space" title="Share on Twitter"><span class="count"><i class="icon-twitter-sign"></i> Tweet</span></a></li>
            <li class="googleplus"><a href="https://plus.google.com/share?url=http://kosl90.github.io/fix-newline-to-space" title="Share on Google Plus"><span class="count"><i class="icon-google-plus-sign"></i> +1</span></a></li>
          </ul>
        </div><!-- /.social-share -->
      </footer>
    </div><!-- /.entry-content -->
    <section id="disqus_thread"></section><!-- /#disqus_thread -->
    
    <div class="read-more">
      
        <div class="read-more-header">
          <a href="http://kosl90.github.io/golang-traps" class="read-more-btn">Read More</a>
        </div><!-- /.read-more-header -->
        <div class="read-more-content">
          <h3><a href="http://kosl90.github.io/golang-traps" title="Golang Traps">Golang Traps</a></h3>
          <p>record golang's traps <a href="http://kosl90.github.io/golang-traps">Continue reading</a></p>
        </div><!-- /.read-more-content -->
      
      <div class="read-more-list">
        
      </div><!-- /.read-more-list -->
      
    </div><!-- /.read-more -->
  </article>
</div><!-- /#main -->

<div class="footer-wrapper">
  <footer role="contentinfo">
    <span>&copy; 2014 Lee. Powered by <a
        class='footer_link' href="http://jekyllrb.com">Jekyll</a> using the <a
        class='footer_link' href="http://mademistakes.com/">HPSTR Theme</a>.</span>

  </footer>
</div><!-- /.footer-wrapper -->

<script src="http://kosl90.github.io/assets/js/vendor/echo.min.js"></script>
<script>Echo.init({offset:'200',throttle: 250});</script>
<script src="//ajax.googleapis.com/ajax/libs/jquery/1.9.1/jquery.min.js"></script>
<script>window.jQuery || document.write('<script src="http://kosl90.github.io/assets/js/vendor/jquery-1.9.1.min.js"><\/script>')</script>
<script src="http://kosl90.github.io/assets/js/scripts.min.js"></script>

<script type="text/javascript">
    /* * * CONFIGURATION VARIABLES: EDIT BEFORE PASTING INTO YOUR WEBPAGE * * */
    var disqus_shortname = 'kosl90'; // required: replace example with your forum shortname

    /* * * DON'T EDIT BELOW THIS LINE * * */
    (function() {
        var dsq = document.createElement('script'); dsq.type = 'text/javascript'; dsq.async = true;
        dsq.src = '//' + disqus_shortname + '.disqus.com/embed.js';
        (document.getElementsByTagName('head')[0] || document.getElementsByTagName('body')[0]).appendChild(dsq);
    })();

    /* * * DON'T EDIT BELOW THIS LINE * * */
    (function () {
        var s = document.createElement('script'); s.async = true;
        s.type = 'text/javascript';
        s.src = '//' + disqus_shortname + '.disqus.com/count.js';
        (document.getElementsByTagName('HEAD')[0] || document.getElementsByTagName('BODY')[0]).appendChild(s);
    }());
</script>
<noscript>Please enable JavaScript to view the <a href="http://disqus.com/?ref_noscript">comments powered by Disqus.</a></noscript>
<a href="http://disqus.com" class="dsq-brlink">comments powered by <span class="logo-disqus">Disqus</span></a>
	        

</body>
</html>
